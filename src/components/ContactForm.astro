---
// src/components/ContactForm.astro
---

<section class="max-w-2xl mx-auto">
  <div class="mb-6 text-center">
    <p class="text-gray-600 dark:text-gray-400 text-base">
      ¿Tenés un proyecto en mente? Hablemos y hagámoslo realidad.
    </p>
  </div>

  <form
    id="contact-form"
    class="space-y-5 bg-gradient-to-br from-white to-gray-50 dark:from-gray-900/50 dark:to-gray-800/50 backdrop-blur-xl p-6 md:p-8 rounded-2xl border border-gray-200 dark:border-white/10 shadow-2xl"
  >
    <div class="grid md:grid-cols-2 gap-4">
      <!-- Nombre -->
      <div class="group">
        <label
          for="name"
          class="block text-xs font-semibold text-gray-800 dark:text-gray-200 mb-2 tracking-wide"
        >
          Nombre completo
        </label>
        <input
          type="text"
          id="name"
          name="from_name"
          required
          class="w-full px-4 py-3 rounded-xl bg-white dark:bg-gray-800/80 border-2 border-gray-200 dark:border-gray-700 focus:border-blue-500 dark:focus:border-blue-400 focus:ring-4 focus:ring-blue-500/10 transition-all duration-300 outline-none text-gray-900 dark:text-white placeholder:text-gray-400 dark:placeholder:text-gray-500 font-medium text-sm"
          placeholder="Juan Pérez"
        />
      </div>

      <!-- Email -->
      <div class="group">
        <label
          for="email"
          class="block text-xs font-semibold text-gray-800 dark:text-gray-200 mb-2 tracking-wide"
        >
          Email
        </label>
        <input
          type="email"
          id="email"
          name="from_email"
          required
          class="w-full px-4 py-3 rounded-xl bg-white dark:bg-gray-800/80 border-2 border-gray-200 dark:border-gray-700 focus:border-blue-500 dark:focus:border-blue-400 focus:ring-4 focus:ring-blue-500/10 transition-all duration-300 outline-none text-gray-900 dark:text-white placeholder:text-gray-400 dark:placeholder:text-gray-500 font-medium text-sm"
          placeholder="juanperez@gmail.com"
        />
      </div>
    </div>

    <!-- Asunto -->
    <div class="group">
      <label
        for="subject"
        class="block text-xs font-semibold text-gray-800 dark:text-gray-200 mb-2 tracking-wide"
      >
        Asunto
      </label>
      <input
        type="text"
        id="subject"
        name="subject"
        required
        class="w-full px-4 py-3 rounded-xl bg-white dark:bg-gray-800/80 border-2 border-gray-200 dark:border-gray-700 focus:border-blue-500 dark:focus:border-blue-400 focus:ring-4 focus:ring-blue-500/10 transition-all duration-300 outline-none text-gray-900 dark:text-white placeholder:text-gray-400 dark:placeholder:text-gray-500 font-medium text-sm"
        placeholder="Propuesta de proyecto web"
      />
    </div>

    <!-- Mensaje -->
    <div class="group">
      <label
        for="message"
        class="block text-xs font-semibold text-gray-800 dark:text-gray-200 mb-2 tracking-wide"
      >
        Mensaje
      </label>
      <textarea
        id="message"
        name="message"
        required
        rows="5"
        class="w-full px-4 py-3 rounded-xl bg-white dark:bg-gray-800/80 border-2 border-gray-200 dark:border-gray-700 focus:border-blue-500 dark:focus:border-blue-400 focus:ring-4 focus:ring-blue-500/10 transition-all duration-300 outline-none resize-none text-gray-900 dark:text-white placeholder:text-gray-400 dark:placeholder:text-gray-500 font-medium leading-relaxed text-sm"
        placeholder="Contame sobre tu proyecto, objetivos y fechas estimadas..."
      ></textarea>
    </div>

    <!-- Botón de envío -->
    <div class="pt-2">
      <button
        type="submit"
        id="submit-btn"
        class="group relative w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-bold py-3.5 px-6 rounded-xl transition-all duration-300 transform hover:scale-[1.02] hover:shadow-2xl hover:shadow-blue-500/30 focus:outline-none focus:ring-4 focus:ring-blue-500/50 disabled:opacity-60 disabled:cursor-not-allowed disabled:hover:scale-100 overflow-hidden"
      >
        <span class="relative z-10 flex items-center justify-center gap-2 text-base tracking-wide">
          <svg class="w-4 h-4 transition-transform group-hover:translate-x-1 rotate-45 mb-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
          </svg>
          <span id="btn-text">Enviar Mensaje</span>
        </span>
        <div class="absolute inset-0 bg-gradient-to-r from-blue-700 to-indigo-700 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
      </button>
    </div>

    <!-- Mensaje de éxito -->
    <div
      id="success-message"
      class="hidden p-4 rounded-xl text-center bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border-2 border-green-200 dark:border-green-700 animate-fade-in shadow-lg"
    >
      <div class="flex items-center justify-center gap-2 mb-1">
        <svg class="w-6 h-6 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <span class="text-lg font-bold text-green-800 dark:text-green-200">¡Mensaje enviado!</span>
      </div>
      <p class="text-green-700 dark:text-green-300 font-medium text-sm">
        Gracias por contactarme. Te responderé a la brevedad.
      </p>
    </div>

    <!-- Mensaje de error -->
    <div
      id="error-message"
      class="hidden p-4 rounded-xl text-center bg-gradient-to-r from-red-50 to-rose-50 dark:from-red-900/20 dark:to-rose-900/20 border-2 border-red-200 dark:border-red-700 animate-fade-in shadow-lg"
    >
      <div class="flex items-center justify-center gap-2 mb-1">
        <svg class="w-6 h-6 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <span class="text-lg font-bold text-red-800 dark:text-red-200">Error al enviar</span>
      </div>
      <p class="text-red-700 dark:text-red-300 font-medium text-sm">
        Hubo un problema. Por favor, intentá nuevamente.
      </p>
    </div>
  </form>

  <!-- Info adicional -->
  <div class="mt-8 text-center">
    <p class="text-xs text-gray-500 dark:text-gray-400">
       ¿Preferís contactarme directo? 
      <a href="mailto:tiagoisidromadoery123@gmail.com" class="text-blue-600 dark:text-blue-400 hover:underline font-semibold">
        Escribime por email
      </a>
    </p>
  </div>
</section>

<script>
  import emailjs from '@emailjs/browser';

  emailjs.init('Cik7hDSXtU9mDw0-6');

  const form = document.getElementById('contact-form') as HTMLFormElement;
  const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;
  const btnText = document.getElementById('btn-text') as HTMLSpanElement;
  const successMessage = document.getElementById('success-message') as HTMLDivElement;
  const errorMessage = document.getElementById('error-message') as HTMLDivElement;

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    submitBtn.disabled = true;
    btnText.textContent = 'Enviando...';

    successMessage.classList.add('hidden');
    errorMessage.classList.add('hidden');

    try {
      const result = await emailjs.sendForm(
        'service_7ttdm7z',
        'template_dxy7co5',
        form
      );

      console.log('SUCCESS!', result.text);

      successMessage.classList.remove('hidden');
      successMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
      
      form.reset();

      setTimeout(() => {
        successMessage.classList.add('hidden');
      }, 5000);

    } catch (error) {
      console.error('FAILED...', error);
      
      errorMessage.classList.remove('hidden');
      errorMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });

      setTimeout(() => {
        errorMessage.classList.add('hidden');
      }, 7000);
    } finally {
      submitBtn.disabled = false;
      btnText.textContent = 'Enviar Mensaje';
    }
  });
</script>

<style>
  @keyframes fade-in {
    from {
      opacity: 0;
      transform: translateY(-20px) scale(0.95);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  .animate-fade-in {
    animation: fade-in 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  input:focus, textarea:focus {
    transform: translateY(-1px);
  }

  button:active {
    transform: scale(0.98);
  }
</style>